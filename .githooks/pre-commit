#!/bin/sh
# Pre-commit hook for ekaya-engine
# Runs comprehensive checks before allowing commit

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if we're in the right directory
if [ ! -f "go.mod" ]; then
    echo "âŒ Error: Not in Go project root directory"
    exit 1
fi

# Run comprehensive make check which includes:
# - go.mod tidy check
# - code formatting check
# - linting (golangci-lint)
# - backend tests with coverage
# - frontend linting
# - TypeScript typecheck
# - frontend tests
echo "ğŸ“‹ Running make check (comprehensive quality checks)..."
echo "This includes: formatting, linting, backend tests, frontend tests, and typecheck"
if make check; then
    echo "âœ… Make check passed - all quality checks successful!"
else
    echo ""
    echo "âŒ Make check failed. Please fix the issues above before committing."
    echo ""
    echo "Tip: Run 'make check' to see detailed error messages"
    echo "     Run 'make test' for just the tests"
    exit 1
fi

echo "âœ… All pre-commit checks passed!"
